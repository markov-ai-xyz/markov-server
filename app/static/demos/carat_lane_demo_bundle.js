(()=>{"use strict";const t=(()=>{let t=1;return()=>t+=1})(),e=(e,a)=>({message:e,type:a,id:t()}),a=(t,a)=>({...e(t,"bot"),...a,loading:!0}),s=t=>e(t,"user"),o=()=>{const t=document.querySelector(".markov-chatbot-kit-chat-message-container");t.scrollTop=t.scrollHeight},n=t=>{const e=document.createElement("div");e.classList.add("markov-chatbot-kit-user-chat-message-container");const a=document.createElement("div");a.classList.add("markov-chatbot-kit-user-avatar-container");const s=document.createElement("div");s.classList.add("markov-chatbot-kit-user-avatar-icon"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#fff" d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"/></svg>';const o=document.createElement("div");o.classList.add("markov-chatbot-kit-user-chat-message"),o.textContent=t;const n=document.createElement("div");return n.classList.add("markov-chatbot-kit-user-chat-message-arrow"),o.appendChild(n),a.appendChild(s),e.appendChild(o),e.appendChild(a),e},c=(t,e,a,s)=>{const{message:o,widget:n,loading:c,id:r}=t,d=document.createElement("div"),l=document.createElement("div");l.classList.add("markov-chatbot-kit-chat-bot-message-container");const h=document.createElement("div");h.classList.add("markov-chatbot-kit-chat-bot-avatar-container");const m=document.createElement("p");m.textContent="B",m.classList.add("markov-chatbot-kit-chat-bot-avatar-letter");const p=document.createElement("div");if(p.classList.add("markov-chatbot-kit-chat-bot-message"),c){const t=i();p.appendChild(t),setTimeout((()=>{s((t=>{const e=t.messages.find((t=>t.id===r));return e.loading=!1,t}))}),750)}else p.textContent=o;const g=document.createElement("div");g.classList.add("markov-chatbot-kit-chat-bot-message-arrow"),p.appendChild(g),h.appendChild(m),l.appendChild(h),l.appendChild(p),d.appendChild(l);const u=document.createElement("div");if(n){const t=e.getWidget(n,a);u.appendChild(t)}return d.appendChild(u),d},i=()=>{const t=document.createElement("div");return t.classList.add("chatbot-loader-container"),t.innerHTML='<svg\n        id="dots"\n        width="50px"\n        height="21px"\n        viewBox="0 0 132 58"\n        version="1.1"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <g stroke="none" fill="none">\n          <g id="chatbot-loader" fill="#fff">\n            <circle id="chatbot-loader-dot1" cx="25" cy="30" r="13"></circle>\n            <circle id="chatbot-loader-dot2" cx="65" cy="30" r="13"></circle>\n            <circle id="chatbot-loader-dot3" cx="105" cy="30" r="13"></circle>\n          </g>\n        </g>\n      </svg>',t},r=(t,e,a,o,i)=>{const r=document.createElement("div");r.classList.add("markov-chatbot-kit-chat-container");const d=document.createElement("div");return d.classList.add("markov-chatbot-kit-chat-inner-container"),d.appendChild((t=>{const e=document.createElement("div");return e.textContent=`Conversation with ${t.botName}`,e.classList.add("markov-chatbot-kit-chat-header"),e})(t)),d.appendChild(((t,e,a,s)=>{const o=document.createElement("div");return o.classList.add("markov-chatbot-kit-chat-message-container"),t.forEach((t=>{const{message:i,type:r}=t;if("bot"===r){const n=c(t,e,a,s);o.appendChild(n)}else{const t=n(i);o.appendChild(t)}})),o})(e.messages,i,e,o)),d.appendChild(((t,e)=>{const a=document.createElement("div");a.classList.add("markov-chatbot-kit-chat-input-container");const o=document.createElement("form");o.classList.add("markov-chatbot-kit-chat-input-form");const n=document.createElement("input");n.classList.add("markov-chatbot-kit-chat-input"),n.placeholder="Write your message here";const c=document.createElement("button");c.classList.add("markov-chatbot-kit-chat-btn-send"),o.onsubmit=a=>{a.preventDefault();const{value:o}=n,c=s(o);e((t=>({...t,messages:[...t.messages,c]}))),t.parse(o),n.value=""};const i=document.createElement("div");return i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#fff" d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"/></svg>',i.classList.add("markov-chatbot-kit-chat-btn-send-icon"),c.appendChild(i),o.appendChild(n),o.appendChild(c),a.appendChild(o),a})(a,o)),r.appendChild(d),r},d=class{constructor(t,e,a){this.createChatBotMessage=t,this.setState=e,this.createClientMessage=a}response(t){let e=[];this.setState((t=>(e=[...t.messages],e.pop(),t))),async function(t,e){var a=localStorage.getItem("markovJwt");const s=await fetch("https://www.markovai.xyz/agent",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!s.ok)throw new Error("Network response was not ok");return await s.json()}(0,{input:t,chat_history:e}).then((t=>{console.log("Data Received:",t);const e=t.output,a=this.createChatBotMessage(e);this.populateResponse(a)})).catch((t=>{console.error("Error:",t)}))}populateResponse(t){this.setState((e=>({...e,messages:[...e.messages,t]})))}},l=class{constructor(t){this.actionProvider=t}parse(t){this.actionProvider.response(t)}},h=t=>{let e=t;const a=[];return[e,t=>{e="function"==typeof t?t(e):{...e,...t},a.forEach((t=>{t(e)}))},t=>{a.push(t)}]},m=class{constructor(t,e){this.setState=t,this.actionProvider=e}addWidget=({widgetName:t,widgetFunc:e,mapStateToProps:a,props:s})=>{this[t]={widget:e,props:s,mapStateToProps:a}};getWidget=(t,e)=>{const a=this[t];if(!a)return;let s={scrollIntoView:o,...(n=a.props,"object"==typeof n?n:{}),...this.mapStateToProps(a.mapStateToProps,e),setState:this.setState,actionProvider:this.actionProvider};var n;return a.widget(s)};mapStateToProps=(t,e)=>{if(t)return t.reduce(((t,a)=>(t[a]=e[a],t)),{})}},p=(t,e)=>{t.classList.add("markov-container"),document.body.appendChild(t);let a=!1;const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.onclick=s=>{s.stopPropagation(),a?(t.style.display="none",a=!1):(t.innerHTML||g(t,e),t.style.display="block",a=!0)},s.classList.add("markov-icon"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 33" width="50" height="50">\n        <path d="M28 32s-4.714-1.855-8.527-3.34H3.437C1.54 28.66 0 27.026 0 25.013V3.644C0 1.633 1.54 0 3.437 0h21.125c1.898 0 3.437 1.632 3.437 3.645v18.404H28V32zm-4.139-11.982a.88.88 0 00-1.292-.105c-.03.026-3.015 2.681-8.57 2.681-5.486 0-8.517-2.636-8.571-2.684a.88.88 0 00-1.29.107 1.01 1.01 0 00-.219.708.992.992 0 00.318.664c.142.128 3.537 3.15 9.762 3.15 6.226 0 9.621-3.022 9.763-3.15a.992.992 0 00.317-.664 1.01 1.01 0 00-.218-.707z" fill="#2898ec"></path>\n      </svg>',document.body.appendChild(s)},g=(t,e)=>{if(!e)return v(t,"I think you forgot to feed me some props. Did you remember to pass a config, a messageparser and an actionprovider?");const o=((t,e)=>{const a=[],s=(async t=>{const e=[];if(!t||"string"!=typeof t)return e.push("API key is missing or is not a string."),e;const a=await fetch("https://www.markovai.xyz/validate-api-key",{method:"POST",headers:{"Content-Type":"application/json","X-API-KEY":t}});if(!a.ok)return e.push("Invalid API key."),e;const s=await a.json();return localStorage.setItem("markovJwt",s.token),e})(t.apiKey);return s.length>0&&a.push(...s),t.initialMessages||a.push("Config must contain property 'initialMessages', and it expects it to be an array of chatbotmessages."),(new e).parse||a.push("Messageparser must implement the method 'parse', please add this method to your object. The signature is parse(message: string)."),a})(e,l),n={messages:o.length?o.map((t=>a(t,{}))):e.initialMessages,...e.state},[c,i,r]=h(n),p=new d(a,i,s),g=new l(p),u=new m(i,p),w=(t=>t.widgets?t.widgets:[])(e);w.forEach((t=>u.addWidget(t))),r((a=>k(t,a,g,e,i,u))),k(t,c,g,e,i,u)};let u;const v=(t,e)=>{u&&t.removeChild(u);const a=(t=>{const e=document.createElement("div");e.classList.add("markov-chatbot-kit-error");const a=document.createElement("div");a.classList.add("markov-chatbot-kit-error-container");const s=c({message:t,loading:!1,id:1});return a.appendChild(s),e.appendChild(a),e})(e);t.appendChild(a)},k=(t,e,a,s,n,c)=>{u&&t.removeChild(u);const i=r(s,e,a,n,c);u=i,t.appendChild(i),document.querySelector(".markov-chatbot-kit-chat-input").focus(),o()};console.log("Start ci"),window.markovJsChatbot={renderWidget:p,createChatBotMessage:a};const w=p;var b=document.querySelector(".markov-ai-widget"),C={apiKey:"mdp-carat-lane",botName:"Markov",initialMessages:[a("Hello there! How can I help you?",{widget:""})],state:{},widgets:[]};localStorage.removeItem("markovJwt"),w(b,C)})();
