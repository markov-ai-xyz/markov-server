(()=>{"use strict";const t=(()=>{let t=1;return()=>t+=1})(),e=(e,o)=>({message:e,type:o,id:t()}),o=(t,o)=>({...e(t,"bot"),...o,loading:!0}),a=t=>e(t,"user"),s=()=>{const t=document.querySelector(".markov-chatbot-kit-chat-message-container");t.scrollTop=t.scrollHeight};async function n(t,e){var o=localStorage.getItem("markovJwt");const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("Network response was not ok");return await a.json()}const i=t=>{const e=document.createElement("div");e.classList.add("markov-chatbot-kit-user-chat-message-container");const o=document.createElement("div");o.classList.add("markov-chatbot-kit-user-avatar-container");const a=document.createElement("div");a.classList.add("markov-chatbot-kit-user-avatar-icon"),a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#fff" d="M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"/></svg>';const s=document.createElement("div");s.classList.add("markov-chatbot-kit-user-chat-message"),s.textContent=t;const n=document.createElement("div");return n.classList.add("markov-chatbot-kit-user-chat-message-arrow"),s.appendChild(n),o.appendChild(a),e.appendChild(s),e.appendChild(o),e},r=(t,e,o,a)=>{const{message:s,widget:n,loading:i,id:r}=t,d=document.createElement("div"),l=document.createElement("div");l.classList.add("markov-chatbot-kit-chat-bot-message-container");const h=document.createElement("div");h.classList.add("markov-chatbot-kit-chat-bot-avatar-container");const p=document.createElement("p");p.textContent="B",p.classList.add("markov-chatbot-kit-chat-bot-avatar-letter");const m=document.createElement("div");if(m.classList.add("markov-chatbot-kit-chat-bot-message"),i){const t=c();m.appendChild(t),setTimeout((()=>{a((t=>{const e=t.messages.find((t=>t.id===r));return e.loading=!1,t}))}),750)}else m.textContent=s;const u=document.createElement("div");u.classList.add("markov-chatbot-kit-chat-bot-message-arrow"),m.appendChild(u),h.appendChild(p),l.appendChild(h),l.appendChild(m),d.appendChild(l);const g=document.createElement("div");if(n){const t=e.getWidget(n,o);g.appendChild(t)}return d.appendChild(g),d},c=()=>{const t=document.createElement("div");return t.classList.add("chatbot-loader-container"),t.innerHTML='<svg\n        id="dots"\n        width="50px"\n        height="21px"\n        viewBox="0 0 132 58"\n        version="1.1"\n        xmlns="http://www.w3.org/2000/svg"\n      >\n        <g stroke="none" fill="none">\n          <g id="chatbot-loader" fill="#fff">\n            <circle id="chatbot-loader-dot1" cx="25" cy="30" r="13"></circle>\n            <circle id="chatbot-loader-dot2" cx="65" cy="30" r="13"></circle>\n            <circle id="chatbot-loader-dot3" cx="105" cy="30" r="13"></circle>\n          </g>\n        </g>\n      </svg>',t},d=(t,e,o,s,n)=>{const c=document.createElement("div");c.classList.add("markov-chatbot-kit-chat-container");const d=document.createElement("div");return d.classList.add("markov-chatbot-kit-chat-inner-container"),d.appendChild((t=>{const e=document.createElement("div");return e.textContent=`Conversation with ${t.botName}`,e.classList.add("markov-chatbot-kit-chat-header"),e})(t)),d.appendChild(((t,e,o,a)=>{const s=document.createElement("div");return s.classList.add("markov-chatbot-kit-chat-message-container"),t.forEach((t=>{const{message:n,type:c}=t;if("bot"===c){const n=r(t,e,o,a);s.appendChild(n)}else{const t=i(n);s.appendChild(t)}})),s})(e.messages,n,e,s)),d.appendChild(((t,e)=>{const o=document.createElement("div");o.classList.add("markov-chatbot-kit-chat-input-container");const s=document.createElement("form");s.classList.add("markov-chatbot-kit-chat-input-form");const n=document.createElement("input");n.classList.add("markov-chatbot-kit-chat-input"),n.placeholder="Write your message here";const i=document.createElement("button");i.classList.add("markov-chatbot-kit-chat-btn-send"),s.onsubmit=o=>{o.preventDefault();const{value:s}=n,i=a(s);e((t=>({...t,messages:[...t.messages,i]}))),t.parse(s),n.value=""};const r=document.createElement("div");return r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#fff" d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"/></svg>',r.classList.add("markov-chatbot-kit-chat-btn-send-icon"),i.appendChild(r),s.appendChild(n),s.appendChild(i),o.appendChild(s),o})(o,s)),c.appendChild(d),c},l=class{constructor(t,e,o){this.createChatBotMessage=t,this.setState=e,this.createClientMessage=o,this.phoneNumber="",this.isNumberConfirmed=!1}handlePhoneNumber(t){let e=[];this.setState((t=>(e=[...t.messages],e.pop(),t)));try{const e=new WebSocket("wss://www.markovai.xyz/authenticate");e.onopen=function(){e.send(t)},e.onmessage=function(t){const e=JSON.parse(t.data);this.populateResponse(e.message),"Confirm"==e.status&&(this.isNumberConfirmed=!0)}.bind(this),e.onclose=function(){if(this.isNumberConfirmed){const e=localStorage.getItem("latitude"),o=localStorage.getItem("longitude");n("https://www.markovai.xyz/location",{phone:t,lat:e,long:o}).then((t=>{console.log("Data Received:",t)})).catch((t=>{console.error("Error:",t)})),this.phoneNumber=t,this.populateResponse("What skills are you seeking a job for?")}}.bind(this),e.onerror=function(t){console.error(`WebSocket error: ${t.message}`)}}catch(t){console.error(`WebSocket error: ${t.message}`)}}response(t){let e=[];this.setState((t=>(e=[...t.messages],e.pop(),t))),n("https://www.markovai.xyz/erekrut-agent",{input:t,chat_history:e,phone_number:this.phoneNumber}).then((t=>{console.log("Data Received:",t),this.populateResponse(t.output)})).catch((t=>{console.error("Error:",t)}))}populateResponse(t){const e=this.createChatBotMessage(t);this.setState((t=>({...t,messages:[...t.messages,e]})))}},h=class{constructor(t){this.actionProvider=t,this.isFirstInteraction=!0}parse(t){this.isFirstInteraction?this.handleFirstInteraction(t):this.actionProvider.response(t)}handleFirstInteraction(t){if(/^\d{10}$/.test(t)){const e=this.prependCountryCode(t);this.actionProvider.handlePhoneNumber(e),this.isFirstInteraction=!1}else this.actionProvider.populateResponse("I apologize for the confusion. Could you please provide your 10 digit phone number?")}prependCountryCode(t){return`91${t}`}},p=t=>{let e=t;const o=[];return[e,t=>{e="function"==typeof t?t(e):{...e,...t},o.forEach((t=>{t(e)}))},t=>{o.push(t)}]},m=class{constructor(t,e){this.setState=t,this.actionProvider=e}addWidget=({widgetName:t,widgetFunc:e,mapStateToProps:o,props:a})=>{this[t]={widget:e,props:a,mapStateToProps:o}};getWidget=(t,e)=>{const o=this[t];if(!o)return;let a={scrollIntoView:s,...(n=o.props,"object"==typeof n?n:{}),...this.mapStateToProps(o.mapStateToProps,e),setState:this.setState,actionProvider:this.actionProvider};var n;return o.widget(a)};mapStateToProps=(t,e)=>{if(t)return t.reduce(((t,o)=>(t[o]=e[o],t)),{})}},u=(t,e)=>{t.classList.add("markov-container"),document.body.appendChild(t);let o=!1;const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.onclick=a=>{a.stopPropagation(),o?(t.style.display="none",o=!1):(t.innerHTML||v(t,e),t.style.display="block",o=!0)},a.classList.add("markov-icon"),a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 33" width="50" height="50">\n        <path d="M28 32s-4.714-1.855-8.527-3.34H3.437C1.54 28.66 0 27.026 0 25.013V3.644C0 1.633 1.54 0 3.437 0h21.125c1.898 0 3.437 1.632 3.437 3.645v18.404H28V32zm-4.139-11.982a.88.88 0 00-1.292-.105c-.03.026-3.015 2.681-8.57 2.681-5.486 0-8.517-2.636-8.571-2.684a.88.88 0 00-1.29.107 1.01 1.01 0 00-.219.708.992.992 0 00.318.664c.142.128 3.537 3.15 9.762 3.15 6.226 0 9.621-3.022 9.763-3.15a.992.992 0 00.317-.664 1.01 1.01 0 00-.218-.707z" fill="#2898ec"></path>\n      </svg>',document.body.appendChild(a),g()},g=()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(t){const e=t.coords.latitude,o=t.coords.longitude;localStorage.setItem("latitude",e),localStorage.setItem("longitude",o)})):console.log("Geolocation not supported by this browser.")},v=(t,e)=>{if(!e)return w(t,"I think you forgot to feed me some props. Did you remember to pass a config, a messageparser and an actionprovider?");const s=((t,e)=>{const o=[],a=(async t=>{const e=[];if(!t||"string"!=typeof t)return e.push("API key is missing or is not a string."),e;const o=await fetch("https://www.markovai.xyz/validate-api-key",{method:"POST",headers:{"Content-Type":"application/json","X-API-KEY":t}});if(!o.ok)return e.push("Invalid API key."),e;const a=await o.json();return localStorage.setItem("markovJwt",a.token),e})(t.apiKey);return a.length>0&&o.push(...a),t.initialMessages||o.push("Config must contain property 'initialMessages', and it expects it to be an array of chatbotmessages."),(new e).parse||o.push("Messageparser must implement the method 'parse', please add this method to your object. The signature is parse(message: string)."),o})(e,h),n={messages:s.length?s.map((t=>o(t,{}))):e.initialMessages,...e.state},[i,r,c]=p(n),d=new l(o,r,a),u=new h(d),g=new m(r,d),v=(t=>t.widgets?t.widgets:[])(e);v.forEach((t=>g.addWidget(t))),c((o=>b(t,o,u,e,r,g))),b(t,i,u,e,r,g)};let k;const w=(t,e)=>{k&&t.removeChild(k);const o=(t=>{const e=document.createElement("div");e.classList.add("markov-chatbot-kit-error");const o=document.createElement("div");o.classList.add("markov-chatbot-kit-error-container");const a=r({message:t,loading:!1,id:1});return o.appendChild(a),e.appendChild(o),e})(e);t.appendChild(o)},b=(t,e,o,a,n,i)=>{k&&t.removeChild(k);const r=d(a,e,o,n,i);k=r,t.appendChild(r),document.querySelector(".markov-chatbot-kit-chat-input").focus(),s()};console.log("Start ci"),window.markovJsChatbot={renderWidget:u,createChatBotMessage:o};const f=u;var C=document.querySelector(".markov-ai-widget"),y={apiKey:"mdp-erekrut",botName:"Erika",initialMessages:[o("Hello there, please share your 10 digit phone number to get started!",{widget:""})],state:{},widgets:[]};localStorage.removeItem("markovJwt"),f(C,y)})();
